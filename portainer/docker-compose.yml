services:
  portainer:
    image: portainer/portainer-ce:2.39.0@sha256:3267f1869e0fa87b843c55f7fd848f9e3001367d053505f4cb8c664e4a997996
    container_name: portainer
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - "${DIRECTORY:?Missing variable DIRECTORY}/portainer:/data"
    ports:
      - "${WEB_PORT:-9443}:9443"
    labels:
      - traefik.enable=true
      - traefik.http.routers.portainer.tls.certresolver=myresolver
      - traefik.http.services.portainer.loadbalancer.server.port=9000
      - homepage.instance.internal.group=Management
      - homepage.instance.internal.name=${HOMEPAGE_NAME:-Portainer}
      - homepage.instance.internal.icon=portainer.png
      # - homepage.instance.public.href=https://portainer.${DOMAIN:?Missing variable DOMAIN}
      - homepage.instance.internal.href=${HOST_URL:-http://localhost}:${WEB_PORT:-9443}
      - homepage.instance.internal.description=Portainer.io Community Edition
      - homepage.instance.internal.widget.type=portainer
      - homepage.instance.internal.widget.url=${HOST_URL:-http://localhost}:${WEB_PORT:-9443}
      - homepage.instance.internal.widget.env=2
      - homepage.instance.internal.widget.key=${PORTAINER_API_KEY}
